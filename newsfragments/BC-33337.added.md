duplicate the build_image function and make it asynchronous